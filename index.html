<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Processos - NUP</title>
</head>
<body>
    <h1>Controle de Processos - NUP</h1>
    <div id="status"></div>
    <button onclick="logout()">🚪 Sair</button>

    <h2>Cadastro de Processo</h2>
    <input id="numero" placeholder="Número do Processo">
    <input id="data" type="date">
    <input id="assunto" placeholder="Assunto">
    <input id="andamento" placeholder="Andamento">
    <input id="link" placeholder="Link">
    <input id="prazo" placeholder="Prazo">
    <button onclick="cadastrarProcesso()">➕ Cadastrar Processo</button>

    <h2>Processos</h2>
    <table id="tabelaProcessos">
        <thead>
            <tr>
                <th>Número</th>
                <th>Data</th>
                <th>Assunto</th>
                <th>Andamento</th>
                <th>Link</th>
                <th>Prazo</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script type="module">
        try {
            console.log("✅ Iniciando carregamento do Firebase...");

            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
            import { getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
            import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

            console.log("✅ Firebase carregado com sucesso!");

            const firebaseConfig = {
                apiKey: "AIzaSyBHDwatGIjcMmFXmbdw_kH4dQW-xtZJgcA",
                authDomain: "controle-processo-nup.firebaseapp.com",
                projectId: "controle-processo-nup",
                storageBucket: "controle-processo-nup.appspot.com",
                messagingSenderId: "375467007404",
                appId: "1:375467007404:web:5f3942fcb6d6aa4d26ee09"
            };

            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const provider = new GoogleAuthProvider();

            console.log("✅ Firebase inicializado com sucesso!");

            provider.setCustomParameters({ prompt: "select_account" });

            async function cadastrarProcesso() {
                const numero = document.getElementById("numero").value;
                const data = document.getElementById("data").value;
                const assunto = document.getElementById("assunto").value;
                const andamento = document.getElementById("andamento").value;
                const link = document.getElementById("link").value;
                const prazo = document.getElementById("prazo").value;

                try {
                    await addDoc(collection(db, "processos"), {
                        numero,
                        data,
                        assunto,
                        andamento,
                        link,
                        prazo
                    });
                    alert("Processo cadastrado com sucesso!");
                    carregarDadosFirestore();
                } catch (erro) {
                    console.error("❌ Erro ao cadastrar processo:", erro);
                    alert("Erro ao cadastrar processo: " + erro.message);
                }
            }

            async function carregarDadosFirestore() {
                try {
                    const processosRef = collection(db, 'processos');
                    const snapshot = await getDocs(processosRef);
                    const dados = snapshot.docs.map(doc => doc.data());

                    console.log("📄 Dados carregados:", dados);

                    if (dados.length === 0) {
                        alert("Nenhum processo encontrado.");
                    } else {
                        preencherTabela(dados);
                    }
                } catch (erro) {
                    console.error("❌ Erro ao carregar processos:", erro);
                    alert("Erro ao carregar processos: " + erro.message);
                }
            }

            function preencherTabela(dados) {
                const tabela = document.getElementById("tabelaProcessos").querySelector("tbody");
                tabela.innerHTML = "";

                dados.forEach(d => {
                    const linha = `<tr>
                        <td>${d.numero || 'N/A'}</td>
                        <td>${d.data || 'N/A'}</td>
                        <td>${d.assunto || 'N/A'}</td>
