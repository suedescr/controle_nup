<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Processos - NUP</title>

    <script type="module">
        // Importação via CDN para rodar no GitHub Pages
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // ✅ Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBHDwatGIjcMmFXmbdw_kH4dQW-xtZJgcA",
            authDomain: "controle-processo-nup.firebaseapp.com",
            projectId: "controle-processo-nup",
            storageBucket: "controle-processo-nup.appspot.com",
            messagingSenderId: "375467007404",
            appId: "1:375467007404:web:5f3942fcb6d6aa4d26ee09"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // ✅ Define Client ID para evitar erro de "Unauthorized domain"
        provider.setCustomParameters({
            client_id: "375467007404-f89c13rct7unu3sahqqsuebcnah96f2e.apps.googleusercontent.com",
            prompt: "select_account"
        });

        // ✅ Função de Login com Google
        async function loginGoogle() {
            try {
                const result = await signInWithPopup(auth, provider);
                console.log("Usuário autenticado:", result.user);
            } catch (error) {
                alert("Erro ao autenticar com Google: " + error.message);
            }
        }

        // ✅ Função de Login com E-mail e Senha
        async function loginEmailSenha() {
            const email = document.getElementById("email").value;
            const senha = document.getElementById("senha").value;
            try {
                await signInWithEmailAndPassword(auth, email, senha);
                console.log("Usuário autenticado com e-mail e senha!");
            } catch (error) {
                alert("Erro ao autenticar: " + error.message);
            }
        }

        // ✅ Função para Criar Conta com E-mail e Senha
        async function registrar() {
            const email = document.getElementById("email").value;
            const senha = document.getElementById("senha").value;
            try {
                await createUserWithEmailAndPassword(auth, email, senha);
                alert("Conta criada com sucesso!");
            } catch (error) {
                alert("Erro ao criar conta: " + error.message);
            }
        }

        // ✅ Função de Logout
        async function logout() {
            try {
                await signOut(auth);
                console.log("Usuário deslogado");
                window.location.reload();
            } catch (error) {
                console.error("Erro ao sair:", error);
            }
        }

        // ✅ Atualiza interface ao mudar estado de autenticação
        onAuthStateChanged(auth, (user) => {
            const loginScreen = document.getElementById("loginScreen");
            const appScreen = document.getElementById("appScreen");

            if (user) {
                loginScreen.style.display = "none";
                appScreen.style.display = "block";
                document.getElementById("status").innerText = `Logado como: ${user.email || user.displayName}`;
                carregarDadosFirestore();
            } else {
                loginScreen.style.display = "block";
                appScreen.style.display = "none";
            }
        });

        // Disponibilizar funções globalmente
        window.loginGoogle = loginGoogle;
        window.loginEmailSenha = loginEmailSenha;
        window.registrar = registrar;
        window.logout = logout;
    </script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        button { padding: 10px; margin: 5px; cursor: pointer; background: #4CAF50; color: white; border: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 8px; }
        th { background-color: #4CAF50; color: white; }
        input { padding: 8px; margin: 5px; width: 250px; }
    </style>
</head>
<body>

    <!-- ✅ Tela de Login -->
    <div id="loginScreen">
        <h2>Faça login para acessar o sistema</h2>
        <input type="email" 
