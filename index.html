<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Processos - NUP</title>

    <script type="module">
        // ‚úÖ Importa√ß√£o do Firebase via CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        // ‚úÖ Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBHDwatGIjcMmFXmbdw_kH4dQW-xtZJgcA",
            authDomain: "controle-processo-nup.firebaseapp.com",
            projectId: "controle-processo-nup",
            storageBucket: "controle-processo-nup.appspot.com",
            messagingSenderId: "375467007404",
            appId: "1:375467007404:web:5f3942fcb6d6aa4d26ee09"
        };

        // ‚úÖ Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // ‚úÖ Fun√ß√£o de Login com Google
        async function loginGoogle() {
            try {
                const result = await signInWithPopup(auth, provider);
                console.log("Usu√°rio autenticado:", result.user);
            } catch (error) {
                alert("Erro ao autenticar com Google: " + error.message);
            }
        }

        // ‚úÖ Fun√ß√£o de Login com E-mail e Senha
        async function loginEmailSenha() {
            const email = document.getElementById("email").value;
            const senha = document.getElementById("senha").value;
            try {
                await signInWithEmailAndPassword(auth, email, senha);
                console.log("Usu√°rio autenticado com e-mail e senha!");
            } catch (error) {
                alert("Erro ao autenticar: " + error.message);
            }
        }

        // ‚úÖ Fun√ß√£o para Criar Conta com E-mail e Senha
        async function registrar() {
            const email = document.getElementById("email").value;
            const senha = document.getElementById("senha").value;

            if (senha.length < 6) {
                alert("A senha deve ter pelo menos 6 caracteres.");
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, senha);
                alert("Conta criada com sucesso! Agora fa√ßa login.");
            } catch (error) {
                if (error.code === "auth/email-already-in-use") {
                    alert("Este e-mail j√° est√° cadastrado. Tente fazer login.");
                } else if (error.code === "auth/invalid-email") {
                    alert("E-mail inv√°lido. Verifique e tente novamente.");
                } else {
                    alert("Erro ao criar conta: " + error.message);
                }
            }
        }

        // ‚úÖ Fun√ß√£o de Logout
        async function logout() {
            try {
                await signOut(auth);
                console.log("Usu√°rio deslogado");
                window.location.reload();
            } catch (error) {
                console.error("Erro ao sair:", error);
            }
        }

        // ‚úÖ Atualiza interface ao mudar estado de autentica√ß√£o
        onAuthStateChanged(auth, (user) => {
            const loginScreen = document.getElementById("loginScreen");
            const appScreen = document.getElementById("appScreen");

            if (user) {
                loginScreen.style.display = "none";
                appScreen.style.display = "block";
                document.getElementById("status").innerText = `Logado como: ${user.email || user.displayName}`;
            } else {
                loginScreen.style.display = "block";
                appScreen.style.display = "none";
            }
        });

        // ‚úÖ Captura erros para evitar tela branca
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            alert("Erro detectado: " + msg + "\nLinha: " + lineNo);
            return true;
        };

        // Disponibilizar fun√ß√µes globalmente
        window.loginGoogle = loginGoogle;
        window.loginEmailSenha = loginEmailSenha;
        window.registrar = registrar;
        window.logout = logout;
    </script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        button { padding: 10px; margin: 5px; cursor: pointer; background: #4CAF50; color: white; border: none; }
        input { padding: 8px; margin: 5px; width: 250px; }
    </style>
</head>
<body>

    <!-- ‚úÖ Tela de Login -->
    <div id="loginScreen">
        <h2>Fa√ßa login para acessar o sistema</h2>
        <input type="email" id="email" placeholder="Digite seu e-mail">
        <input type="password" id="senha" placeholder="Digite sua senha">
        <button onclick="loginEmailSenha()">üîë Login</button>
        <button onclick="registrar()">üìù Criar Conta</button>
        <hr>
        <button onclick="loginGoogle()">üîµ Login com Google</button>
    </div>

    <!-- ‚úÖ Tela do Aplicativo -->
    <div id="appScreen" style="display: none;">
        <h1>Controle de Processos - NUP</h1>
        <div id="status"></div>
        <button onclick="logout()">üö™ Sair</button>
    </div>

</body>
</html>
