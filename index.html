<script type="module">
    // ImportaÃ§Ã£o via CDN para rodar no GitHub Pages
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

    // âœ… ConfiguraÃ§Ã£o do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBHDwatGIjcMmFXmbdw_kH4dQW-xtZJgcA",
        authDomain: "controle-processo-nup.firebaseapp.com",
        projectId: "controle-processo-nup",
        storageBucket: "controle-processo-nup.appspot.com",
        messagingSenderId: "375467007404",
        appId: "1:375467007404:web:5f3942fcb6d6aa4d26ee09"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // âœ… FunÃ§Ã£o de Login com E-mail e Senha
    async function loginEmailSenha() {
        const email = document.getElementById("email").value;
        const senha = document.getElementById("senha").value;
        try {
            await signInWithEmailAndPassword(auth, email, senha);
            console.log("UsuÃ¡rio autenticado com e-mail e senha!");
        } catch (error) {
            alert("Erro ao autenticar: " + error.message);
        }
    }

    // âœ… FunÃ§Ã£o para Criar Conta com E-mail e Senha (Corrigida)
    async function registrar() {
        const email = document.getElementById("email").value;
        const senha = document.getElementById("senha").value;

        // ðŸ›‘ Verifica se a senha tem pelo menos 6 caracteres
        if (senha.length < 6) {
            alert("A senha deve ter pelo menos 6 caracteres.");
            return;
        }

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
            alert("Conta criada com sucesso! Agora faÃ§a login.");
        } catch (error) {
            // ðŸ›‘ Tratamento de erros do Firebase
            if (error.code === "auth/email-already-in-use") {
                alert("Este e-mail jÃ¡ estÃ¡ cadastrado. Tente fazer login.");
            } else if (error.code === "auth/invalid-email") {
                alert("E-mail invÃ¡lido. Verifique e tente novamente.");
            } else {
                alert("Erro ao criar conta: " + error.message);
            }
        }
    }

    // âœ… FunÃ§Ã£o de Logout
    async function logout() {
        try {
            await signOut(auth);
            console.log("UsuÃ¡rio deslogado");
            window.location.reload();
        } catch (error) {
            console.error("Erro ao sair:", error);
        }
    }

    // âœ… Atualiza interface ao mudar estado de autenticaÃ§Ã£o
    onAuthStateChanged(auth, (user) => {
        const loginScreen = document.getElementById("loginScreen");
        const appScreen = document.getElementById("appScreen");

        if (user) {
            loginScreen.style.display = "none";
            appScreen.style.display = "block";
            document.getElementById("status").innerText = `Logado como: ${user.email || user.displayName}`;
        } else {
            loginScreen.style.display = "block";
            appScreen.style.display = "none";
        }
    });

    // Disponibilizar funÃ§Ãµes globalmente
    window.loginEmailSenha = loginEmailSenha;
    window.registrar = registrar;
    window.logout = logout;
</script>
